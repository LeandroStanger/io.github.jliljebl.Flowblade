{
    "id": "io.github.jliljebl.Flowblade",
    "branch": "stable",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.28",
    "sdk": "org.gnome.Sdk",
    "command": "flowblade",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--device=dri",
        "--filesystem=host",
        "--env=FREI0R_PATH=/app/lib/frei0r-1",
        "--env=LADSPA_PATH=/app/lib/ladspa",
        "--env=DCONF_USER_CONFIG_DIR=.config/dconf",
        "--filesystem=xdg-run/dconf",
        "--filesystem=~/.config/dconf:ro",
        "--talk-name=ca.desrt.dconf"
    ],
    "modules": [
        {
            "name": "eigen",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://bitbucket.org/eigen/eigen/get/3.3.4.tar.bz2",
                    "sha256": "dd254beb0bafc695d0f62ae1a222ff85b52dbaa3a16f76e781dce22d0d20a4a6"
                }
            ],
            "cleanup": [
                "/share"
            ]
        },
        {
            "name": "fftw",
            "buildsystem": "simple",
            "build-commands": [
                "./configure --prefix=/app --disable-doc --with-pic --enable-threads --enable-type-prefix",
                "make -j `nproc`",
                "make install",
                "make clean",
                "./configure --prefix=/app --disable-doc --with-pic --enable-threads --enable-type-prefix --enable-float",
                "make -j `nproc`",
                "make install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://www.fftw.org/fftw-3.3.7.tar.gz",
                    "sha256": "3b609b7feba5230e8f6dd8d245ddbefac324c5a6ae4186947670d9ac2cd25573"
                }
            ],
            "cleanup": [
                "/bin",
                "/share/man"
            ]
        },
        {
            "name": "gmic",
            "buildsystem": "simple",
            "subdir": "src",
            "build-commands": [
                "make -j `nproc` OPENEXR_CFLAGS='' OPENEXR_LIBS='' OPENCV_CFLAGS='' OPENCV_LIBS='' cli",
                "install -Dm755 gmic /app/bin/gmic"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://gmic.eu/files/source/gmic_2.2.2.tar.gz",
                    "sha256": "cce23f791c7c9f4a09ef00c4b696b29fe2ee55725cc03e9273c3da52bd900e7f"
                },
                {
                    "type": "shell",
                    "commands": [
                        "cd src && sed -i 's/-mtune=generic//g' Makefile"
                    ],
                    "only-arches": [
                        "arm"
                    ]
                }
            ]
        },
        {
            "name": "movit",
            "config-opts": [
                "--disable-static",
                "GTEST_DIR=./googletest"
            ],
            "make-args": [
                "GTEST_DIR=./googletest"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.debian.org/debian/pool/main/m/movit/movit_1.6.2.orig.tar.gz",
                    "sha256": "7428d56c23a38224c9333b8bb4a0c4f6b171ba64d4799c16516d40b30d0230e1"
                },
                {
                    "type": "file",
                    "url": "https://github.com/google/googletest/archive/release-1.8.0.tar.gz",
                    "sha256": "58a6f4277ca2bc8565222b3bbd58a177609e9c488e8a72649359ba51450db7d8",
                    "dest-filename": "gtest.tar.gz"
                },
                {
                    "type": "shell",
                    "commands": [
                        "tar xf gtest.tar.gz --strip 1"
                    ]
                }
            ]
        },
        {
            "name": "frei0r-plugins",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.dyne.org/frei0r/frei0r-plugins-1.6.1.tar.gz",
                    "sha256": "e0c24630961195d9bd65aa8d43732469e8248e8918faa942cfb881769d11515e"
                }
            ]
        },
        {
            "name": "sox",
            "config-opts": [
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://http.debian.net/debian/pool/main/s/sox/sox_14.4.2.orig.tar.bz2",
                    "sha256": "81a6956d4330e75b5827316e44ae381e6f1e8928003c6aa45896da9041ea149c"
                }
            ],
            "cleanup": [
                "/bin",
                "/share/man"
            ]
        },
        {
            "name": "x264",
            "config-opts": [
                "--disable-cli",
                "--enable-shared"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.videolan.org/x264/snapshots/x264-snapshot-20171223-2245-stable.tar.bz2",
                    "sha256": "ee4ba2c3d1caf786ad66d3fa86bdc368a8f827318788a62a9c8444b2c35816bf"
                }
            ]
        },
        {
            "name": "ffmpeg",
            "config-opts": [
                "--enable-gpl",
                "--disable-static",
                "--enable-shared",
                "--disable-doc",
                "--disable-programs",
                "--enable-libfontconfig",
                "--enable-libfreetype",
                "--enable-libopus",
                "--enable-librsvg",
                "--enable-libvpx",
                "--enable-libx264"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ffmpeg.org/releases/ffmpeg-3.4.2.tar.xz",
                    "sha256": "2b92e9578ef8b3e49eeab229e69305f5f4cbc1fdaa22e927fc7fca18acccd740"
                }
            ],
            "cleanup": [
                "/share/ffmpeg"
            ]
        },
        {
            "name": "dbus-python",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://dbus.freedesktop.org/releases/dbus-python/dbus-python-1.2.4.tar.gz",
                    "sha256": "e2f1d6871f74fba23652e51d10873e54f71adab0525833c19bad9e99b1b2f9cc"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig",
                "/lib/python2.7/site-packages/*.la",
                "/share/doc"
            ]
        },
        {
            "name": "numpy",
            "buildsystem": "simple",
            "build-commands": [
                "python2 setup.py build -j `nproc` install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/ee/66/7c2690141c520db08b6a6f852fa768f421b0b50683b7bbcd88ef51f33170/numpy-1.14.0.zip",
                    "sha256": "3de643935b212307b420248018323a44ec51987a336d1d747c1322afc3c099fb"
                }
            ],
            "cleanup": [
                "/bin",
                "/lib/python2.7/site-packages/numpy/core/lib/libnpymath.a",
                "/lib/python2.7/site-packages/numpy/tests",
                "/lib/python2.7/site-packages/numpy/*/tests"
            ]
        },
        {
            "name": "pillow",
            "buildsystem": "simple",
            "build-options": {
                "arch": {
                    "i386": {
                        "env": {
                            "MAX_CONCURRENCY": "1"
                        }
                    }
                }
            },
            "build-commands": [
                "python2 setup.py install --prefix=/app --root=/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/0f/57/25be1a4c2d487942c3ed360f6eee7f41c5b9196a09ca71c54d1a33c968d9/Pillow-5.0.0.tar.gz",
                    "sha256": "12f29d6c23424f704c66b5b68c02fe0b571504459605cfe36ab8158359b0e1bb"
                },
                {
                    "type": "shell",
                    "commands": [
                        "sed -i 's/if not platform_/if not dirs/' setup.py"
                    ]
                }
            ],
            "cleanup": [
                "/bin"
            ]
        },
        {
            "name": "pycairo",
            "buildsystem": "simple",
            "build-commands": [
                "python2 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/ef/97/b33dc533ea6076d4ea9cbd2fe049a2b4a3df5c5b6fba9a182616f6f8d310/pycairo-1.15.4.tar.gz",
                    "sha256": "ee4c3068c048230e5ce74bb8994a024711129bde1af1d76e3276c7acd81c4357"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "pygobject",
            "build-options": {
                "env": {
                    "PYTHON": "/usr/bin/python2"
                }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/pygobject/3.26/pygobject-3.26.1.tar.xz",
                    "sha256": "f5577b9b9c70cabb9a60d81b855d488b767c66f867432e7fb64aa7269b04d1a9"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig",
                "/lib/python2.7/site-packages/gi/*.la"
            ]
        },
        {
            "name": "swig",
            "config-opts": [
                "--without-alllang",
                "--with-python=/usr/bin/python",
                "--without-boost",
                "--without-pcre"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://http.debian.net/debian/pool/main/s/swig/swig_3.0.12.orig.tar.gz",
                    "sha256": "7cf9f447ae7ed1c51722efc45e7f14418d15d7a1e143ac9f09a668999f4fc94d"
                }
            ],
            "cleanup": [
                "*"
            ]
        },
        {
            "name": "SDL1",
            "rm-configure": true,
            "config-opts": [
                "--disable-static",
                "--disable-pulseaudio",
                "--enable-alsa"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.libsdl.org/release/SDL-1.2.15.tar.gz",
                    "sha256": "d6d316a793e5e348155f0dd93b979798933fb98aa1edebcc108829d6474aad00"
                },
                {
                    "type": "patch",
                    "path": "sdl-libx11-build.patch"
                },
                {
                    "type": "script",
                    "dest-filename": "autogen.sh",
                    "commands": [
                        "sed -i -e 's/.*AM_PATH_ESD.*//' configure.in",
                        "cp -p /usr/share/automake-*/config.{sub,guess} build-scripts",
                        "aclocal",
                        "libtoolize",
                        "autoconf"
                    ]
                }
            ],
            "cleanup": [
                "/bin",
                "/share/man",
                "/share/aclocal",
                "/include",
                "/lib/pkgconfig",
                "/lib/*.la",
                "/lib/*.a"
            ]
        },
        {
            "name": "jack2",
            "buildsystem": "simple",
            "build-commands": [
                "./waf configure --prefix=/app",
                "./waf build -j `nproc`",
                "./waf install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jackaudio/jack2/releases/download/v1.9.12/jack2-1.9.12.tar.gz",
                    "sha256": "deefe2f936dc32f59ad3cef7e37276c2035ef8a024ca92118f35c9a292272e33"
                }
            ],
            "cleanup": [
                "/share/man"
            ]
        },
        {
            "name": "swh-plugins",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/swh/ladspa/archive/v0.4.17.tar.gz",
                    "sha256": "d1b090feec4c5e8f9605334b47faaad72db7cc18fe91d792b9161a9e3b821ce7"
                }
            ]
        },
        {
            "name": "ladspa",
            "buildsystem": "simple",
            "subdir": "src",
            "build-commands": [
                "make INSTALL_PLUGINS_DIR=/app/lib/ladspa/ INSTALL_INCLUDE_DIR=/app/include/ INSTALL_BINARY_DIR=/app/bin/ install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.ladspa.org/download/ladspa_sdk_1.13.tgz",
                    "sha256": "b5ed3f4f253a0f6c1b7a1f4b8cf62376ca9f51d999650dd822650c43852d306b"
                }
            ]
        },
        {
            "name": "mlt",
            "config-opts": [
                "--enable-gpl",
                "--enable-gpl3",
                "--swig-languages=python",
                "--disable-gtk2"
            ],
            "post-install": [
                "install -Dm644 src/swig/python/mlt.py /app/lib/python2.7/site-packages/mlt.py",
                "install -Dm755 src/swig/python/_mlt.so /app/lib/python2.7/site-packages/_mlt.so"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/mltframework/mlt.git",
                    "commit": "446b6fa72d57f037afee8102c299367d05c83e4c"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "flowblade",
            "buildsystem": "simple",
            "subdir": "flowblade-trunk",
            "build-commands": [
                "python2 setup.py install --prefix=/app --install-lib=/app/share/flowblade --install-data=/app"
            ],
            "post-install": [
                "mv /app/share/mime/packages/flowblade.xml /app/share/mime/packages/io.github.jliljebl.Flowblade.xml",
                "mkdir -p /app/share/icons/hicolor/128x128/apps",
                "mv /app/share/pixmaps/flowblade.png /app/share/icons/hicolor/128x128/apps/io.github.jliljebl.Flowblade.png",
                "mv /app/share/applications/flowblade.desktop /app/share/applications/io.github.jliljebl.Flowblade.desktop",
                "desktop-file-edit --set-key=Icon --set-value='io.github.jliljebl.Flowblade' /app/share/applications/io.github.jliljebl.Flowblade.desktop",
                "desktop-file-edit --set-key=Exec --set-value='flowblade %f' /app/share/applications/io.github.jliljebl.Flowblade.desktop",
                "install -Dm644 ../io.github.jliljebl.Flowblade.appdata.xml /app/share/appdata/io.github.jliljebl.Flowblade.appdata.xml"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jliljebl/flowblade/archive/v1.16.tar.gz",
                    "sha256": "2b33535ca92ed6c179cf804ccc9cd742194742bdddcad0bd8c3387ca7a4327ef"
                },
                {
                    "type": "shell",
                    "commands": [
                        "cd flowblade-trunk && sed -i 's|/usr|/app|g' flowblade Flowblade/tools/gmic.py && sed -i 's|/usr/share/locale|/app/share/flowblade/Flowblade/locale|g' Flowblade/translations.py"
                    ]
                },
                {
                    "type": "file",
                    "path": "io.github.jliljebl.Flowblade.appdata.xml"
                }
            ],
            "cleanup": [
                "/share/man",
                "/share/pixmaps"
            ]
        }
    ],
    "cleanup": [
        "/include",
        "/lib/cmake",
        "/lib/pkgconfig",
        "/share/pkgconfig",
        "*.a",
        "*.la"
    ]
}
